     1                                  bits 32
     2                                  
     3                                  
     4                                  global start        
     5                                  
     6                                  extern exit, fopen, fclose, fprintf, printf
     7                                  import exit msvcrt.dll
     8                                  import fopen msvcrt.dll
     9                                  import fclose msvcrt.dll
    10                                  import fprintf msvcrt.dll
    11                                  import printf msvcrt.dll
    12                                  
    13                                  segment data use32 class=data
    14 00000000 6669736965722E7478-         nume_fisier db "fisier.txt", 0
    14 00000009 7400               
    15 0000000B 7700                        mod_acces db "w", 0
    16 0000000D FFFFFFFF                    descriptor dd -1
    17                                      
    18 00000011 416E61206172652035-         text db "Ana are 5 mere. A mancat 3, dar a mai cumparat 8.", 0
    18 0000001A 206D6572652E204120-
    18 00000023 6D616E63617420332C-
    18 0000002C 206461722061206D61-
    18 00000035 692063756D70617261-
    18 0000003E 7420382E00         
    19                                      len equ $ - text - 1
    20                                      
    21 00000043 53756D612065737465-         format_afis db "Suma este: %d", 0
    21 0000004C 3A20256400         
    22                                      
    23 00000051 446573636869646572-         eroare db "Deschiderea fisierului a esuat", 0
    23 0000005A 656120666973696572-
    23 00000063 756C75692061206573-
    23 0000006C 75617400           
    24                                  
    25                                  ; 19. Se dau in segmentul de date un nume de fisier si un text (poate contine orice tip de caracter). Sa se calculeze suma cifrelor din text. Sa se creeze un fisier cu numele dat si sa se scrie suma obtinuta in fisi
    26                                  segment code use32 class=code
    27                                      start:
    28                                          ; fopen(nume_fisier, mod_acces)
    29 00000000 68[0B000000]                    push dword mod_acces
    30 00000005 68[00000000]                    push dword nume_fisier
    31 0000000A FF15[00000000]                  call [fopen]
    32 00000010 83C408                          add esp, 4*2
    33                                          
    34 00000013 83F800                          cmp eax, 0
    35 00000016 744F                            je eroare_deschidere
    36                                          
    37 00000018 A3[0D000000]                    mov [descriptor], eax
    38                                          
    39 0000001D FC                              cld
    40 0000001E BE[11000000]                    mov esi, text
    41 00000023 B931000000                      mov ecx, len
    42 00000028 BB00000000                      mov ebx, 0 ; retinem suma in ebx
    43                                          repeta:
    44 0000002D B800000000                          mov eax, 0
    45 00000032 AC                                  lodsb 
    46 00000033 3C30                                cmp al, '0'
    47 00000035 7C08                                jl next
    48                                              
    49 00000037 3C39                                cmp al, '9'
    50 00000039 7F04                                jg next
    51                                              
    52 0000003B 2C30                                sub al, '0'
    53 0000003D 01C3                                add ebx, eax
    54                                              
    55                                              next:
    56                                              
    57 0000003F E2EC                            loop repeta
    58                                          
    59                                          ; fprintf(descriptor, format_afis, ebx)
    60 00000041 53                              push ebx
    61 00000042 68[43000000]                    push dword format_afis
    62 00000047 FF35[0D000000]                  push dword [descriptor]
    63 0000004D FF15[00000000]                  call [fprintf]
    64 00000053 83C40C                          add esp, 4*3
    65                                              
    66                                          
    67                                          ; fclose(descriptor)
    68 00000056 FF35[0D000000]                  push dword [descriptor]
    69 0000005C FF15[00000000]                  call [fclose]
    70 00000062 83C404                          add esp, 4
    71                                          
    72 00000065 EB0E                            jmp final
    73                                          eroare_deschidere:
    74 00000067 68[51000000]                        push dword eroare
    75 0000006C FF15[00000000]                      call [printf]
    76 00000072 83C404                              add esp, 4
    77                                              
    78                                          final:
    79                                          ; exit(0)
    80 00000075 6A00                            push    dword 0      ; push the parameter for exit onto the stack
    81 00000077 FF15[00000000]                  call    [exit]       ; call exit to terminate the program
